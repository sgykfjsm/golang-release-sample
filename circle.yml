machine:
  timezone:
    Asia/Tokyo
  environment:
    FIRST_GOPATH: "$(echo ${GOPATH} | cut -d: -f1)"
    REPOSITORY_DOMAIN: github.com
    COPY_DESTINATION: ${FIRST_GOPATH}/${REPOSITORY_DOMAIN}/${CIRCLE_USERNAME}

checkout:
  post:
    - rm -rf ${COPY_DESTINATION}
    - mkdir -pv ${COPY_DESTINATION}
    - cp -pR ${HOME}/${CIRCLE_PROJECT_REPONAME} ${COPY_DESTINATION}

dependencies:
  override:
    - make deps
    - make deps-release

test:
  override:
    - make test

deployment:
  release:
    branch: master
    commands:
      - make dist
      - make clean
